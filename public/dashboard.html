<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aroodes Dashboard</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=IM+Fell+English&display=swap" rel="stylesheet">
  
  <style>
    body {
      font-family: 'IM Fell English', serif;
      background: linear-gradient(135deg, #0a0612, #1a0a2e, #16213e);
      color: #e9e9e9;
      min-height: 100vh;
    }
    .title-font { font-family: 'Cinzel Decorative', serif; }
    .glass {
      background: rgba(20, 20, 40, 0.95);
      backdrop-filter: blur(12px);
      border: 2px solid #d4af37;
    }
    .profile-img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid #d4af37;
    }
  </style>
</head>
<body>

  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const PATHWAYS = [
      { id: 'fool', name: 'The Fool', image: '/pathways/fool.png', desc: 'Cunning & Miracles' },
      { id: 'error', name: 'Error', image: '/pathways/error.png', desc: 'Fate & Parasites' },
      { id: 'door', name: 'Door', image: '/pathways/door.png.webp', desc: 'Space & Teleportation' },
      { id: 'visionary', name: 'Visionary', image: '/pathways/visionary.png.webp', desc: 'Mind & Dragons' },
      { id: 'sun', name: 'The Sun', image: '/pathways/sun.png.webp', desc: 'Light & Purification' },
      { id: 'tyrant', name: 'Tyrant', image: '/pathways/tyrant.png.webp', desc: 'Storms & Ocean' },
      { id: 'death', name: 'Death', image: '/pathways/death.png', desc: 'Undead & Spirits' },
      { id: 'moon', name: 'The Moon', image: '/pathways/moon.png', desc: 'Madness & Beauty' },
      { id: 'red_priest', name: 'Red Priest', image: '/pathways/red_priest.png', desc: 'War & Strategy' },
      { id: 'demoness', name: 'Demoness', image: '/pathways/demoness.png.webp', desc: 'Beauty & Calamity' },
      { id: 'hanged_man', name: 'Hanged Man', image: '/pathways/hanged_man.png', desc: 'Sea & Storms' },
      { id: 'darkness', name: 'Darkness', image: '/pathways/darkness.png.webp', desc: 'Shadows & Stealth' }
    ];

    function App() {
      const [user, setUser] = useState(null);
      const [activeTab, setActiveTab] = useState('home');
      const [beyonders, setBeyonders] = useState([]);
      const [loading, setLoading] = useState(true);
      const [menuOpen, setMenuOpen] = useState(false);
      const [selectedPathway, setSelectedPathway] = useState(null);

      useEffect(() => {
        fetchData();
      }, []);

      const fetchData = async () => {
        try {
          // Get user
          const userRes = await fetch('/api/me').catch(() => null);
          if (userRes?.ok) {
            const userData = await userRes.json();
            setUser(userData);
          }

          // Get beyonders
          const beyondersRes = await fetch('/api/beyonders');
          const beyondersData = await beyondersRes.json();
          
          console.log('Beyonders fetched:', beyondersData);
          
          if (Array.isArray(beyondersData)) {
            setBeyonders(beyondersData);
          }

          setLoading(false);
        } catch (error) {
          console.error('Fetch error:', error);
          setLoading(false);
        }
      };

      const selectPathway = async (pathwayId) => {
        if (!user) {
          alert('Please login first!');
          window.location.href = '/login';
          return;
        }

        if (user.pathway) {
          alert(`You already selected: ${user.pathway}`);
          return;
        }

        try {
          const response = await fetch('/api/select-pathway', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ pathwayId })
          });

          const data = await response.json();

          if (response.ok) {
            alert('‚úÖ Pathway selected successfully!');
            setSelectedPathway(null);
            await fetchData();
          } else {
            alert('‚ùå ' + (data.error || 'Failed to select pathway'));
          }
        } catch (error) {
          alert('‚ùå Error selecting pathway');
        }
      };

      const getAvatar = (userId, avatar) => {
        if (!userId || !avatar) return 'https://cdn.discordapp.com/embed/avatars/0.png';
        return `https://cdn.discordapp.com/avatars/${userId}/${avatar}.png`;
      };

      return (
        <div>
          {/* Navbar */}
          <nav className="glass sticky top-0 z-50">
            <div className="max-w-7xl mx-auto px-4 py-4">
              <div className="flex justify-between items-center">
                <div className="flex items-center gap-3">
                  <div className="text-3xl">üåô</div>
                  <h1 className="text-xl md:text-2xl title-font" style={{color: '#d4af37'}}>AROODES</h1>
                </div>

                {user && (
                  <div className="flex items-center gap-3 glass px-3 py-2 rounded-lg">
                    <div className="hidden sm:block text-right">
                      <div className="font-bold text-sm" style={{color: '#d4af37'}}>{user.username}</div>
                      <div className="text-xs text-gray-400">{user.pathway || 'No Pathway'}</div>
                    </div>
                    <img src={getAvatar(user.id, user.avatar)} className="profile-img" alt="Avatar" />
                  </div>
                )}

                <div className="hidden md:flex gap-2">
                  {['home', 'pathways', 'games', 'beyonders'].map(tab => (
                    <button
                      key={tab}
                      onClick={() => setActiveTab(tab)}
                      className={`px-4 py-2 rounded-lg capitalize ${
                        activeTab === tab ? 'bg-yellow-600 text-black font-bold' : 'hover:bg-yellow-600/20'
                      }`}
                    >
                      {tab}
                    </button>
                  ))}
                  {!user ? (
                    <a href="/login" className="px-4 py-2 bg-yellow-600 text-black font-bold rounded-lg">Login</a>
                  ) : (
                    <a href="/logout" className="px-4 py-2 bg-red-500/20 rounded-lg">Logout</a>
                  )}
                </div>

                <button onClick={() => setMenuOpen(!menuOpen)} className="md:hidden text-2xl" style={{color: '#d4af37'}}>
                  {menuOpen ? '‚úï' : '‚ò∞'}
                </button>
              </div>

              {menuOpen && (
                <div className="md:hidden mt-4 space-y-2">
                  {['home', 'pathways', 'games', 'beyonders'].map(tab => (
                    <button
                      key={tab}
                      onClick={() => { setActiveTab(tab); setMenuOpen(false); }}
                      className={`w-full text-left px-4 py-3 rounded-lg capitalize ${
                        activeTab === tab ? 'bg-yellow-600 text-black font-bold' : 'hover:bg-yellow-600/20'
                      }`}
                    >
                      {tab}
                    </button>
                  ))}
                </div>
              )}
            </div>
          </nav>

          {/* Main */}
          <main className="max-w-7xl mx-auto px-4 py-6">
            {loading ? (
              <div className="text-center py-20">
                <div className="text-6xl mb-4">üåô</div>
                <div className="text-2xl" style={{color: '#d4af37'}}>Loading...</div>
              </div>
            ) : (
              <>
                {activeTab === 'home' && <Home user={user} beyonders={beyonders} />}
                {activeTab === 'pathways' && (
                  <Pathways 
                    user={user} 
                    pathways={PATHWAYS} 
                    onSelect={setSelectedPathway} 
                  />
                )}
                {activeTab === 'games' && <Games user={user} />}
                {activeTab === 'beyonders' && <Beyonders beyonders={beyonders} getAvatar={getAvatar} />}
              </>
            )}
          </main>

          {/* Pathway Selection Modal */}
          {selectedPathway && (
            <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/90" onClick={() => setSelectedPathway(null)}>
              <div className="glass rounded-2xl p-8 max-w-md w-full" onClick={e => e.stopPropagation()}>
                <h2 className="text-3xl title-font mb-4" style={{color: '#d4af37'}}>
                  {selectedPathway.name}
                </h2>
                <div className="h-48 mb-4 bg-black/30 rounded flex items-center justify-center">
                  <img src={selectedPathway.image} className="max-h-full max-w-full object-contain" alt={selectedPathway.name} />
                </div>
                <p className="text-gray-300 mb-6">{selectedPathway.desc}</p>
                <div className="space-y-3">
                  <button 
                    onClick={() => selectPathway(selectedPathway.id)}
                    className="w-full px-6 py-3 bg-yellow-600 text-black font-bold rounded-lg hover:bg-yellow-500"
                  >
                    Select This Pathway
                  </button>
                  <button 
                    onClick={() => setSelectedPathway(null)}
                    className="w-full px-6 py-3 border border-gray-600 rounded-lg hover:bg-gray-800"
                  >
                    Cancel
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    function Home({ user, beyonders }) {
      return (
        <div className="space-y-8">
          <div className="text-center">
            <h1 className="text-4xl md:text-6xl title-font mb-4" style={{color: '#d4af37'}}>
              Welcome to Aroodes
            </h1>
            {!user && (
              <a href="/login" className="inline-block mt-4 px-8 py-3 bg-yellow-600 text-black font-bold rounded-lg">
                Begin Your Journey
              </a>
            )}
          </div>

          <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            <StatCard icon="üîÆ" title="Beyonders" value={beyonders.length} />
            <StatCard icon="üëº" title="Angels" value={beyonders.filter(b => b.sequence <= 3 && b.sequence > 0).length} />
            <StatCard icon="‚öúÔ∏è" title="Gods" value={beyonders.filter(b => b.sequence === 0).length} />
            <StatCard icon="üé≠" title="Pathways" value="22" />
          </div>

          {user && (
            <div className="glass rounded-xl p-6">
              <h2 className="text-2xl title-font mb-4" style={{color: '#d4af37'}}>Your Progress</h2>
              <div className="grid grid-cols-3 gap-4">
                <div>
                  <div className="text-gray-400 text-sm">Pathway</div>
                  <div className="font-bold capitalize" style={{color: '#d4af37'}}>
                    {user.pathway || 'None'}
                  </div>
                </div>
                <div>
                  <div className="text-gray-400 text-sm">Sequence</div>
                  <div className="font-bold" style={{color: '#d4af37'}}>{user.sequence || 9}</div>
                </div>
                <div>
                  <div className="text-gray-400 text-sm">Points</div>
                  <div className="font-bold" style={{color: '#d4af37'}}>{user.spiritualPoints || 0}</div>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    function Pathways({ user, pathways, onSelect }) {
      return (
        <div className="space-y-6">
          <h2 className="text-3xl title-font text-center" style={{color: '#d4af37'}}>
            {user?.pathway ? `Your Pathway: ${user.pathway.toUpperCase()}` : 'Choose Your Pathway'}
          </h2>
          <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
            {pathways.map(p => (
              <div 
                key={p.id} 
                onClick={() => !user?.pathway && onSelect(p)}
                className="glass rounded-xl p-4 cursor-pointer hover:scale-105 transition"
              >
                <div className="h-32 mb-3 bg-black/30 rounded flex items-center justify-center">
                  <img src={p.image} className="max-h-full max-w-full" alt={p.name} />
                </div>
                <h3 className="text-center text-sm font-bold" style={{color: '#d4af37'}}>{p.name}</h3>
                <p className="text-center text-xs text-gray-400">{p.desc}</p>
              </div>
            ))}
          </div>
        </div>
      );
    }

    function Games({ user }) {
      return (
        <div className="space-y-6">
          <h2 className="text-3xl title-font text-center" style={{color: '#d4af37'}}>Games</h2>
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            {['üÉè Tarot', 'üé≠ Acting', 'üìö Quiz', 'üì∫ Ads'].map(game => (
              <div key={game} className="glass rounded-xl p-6 text-center">
                <div className="text-5xl mb-3">{game.split(' ')[0]}</div>
                <h3 className="mb-2" style={{color: '#d4af37'}}>{game.split(' ')[1]}</h3>
                <button className="w-full px-4 py-2 bg-yellow-600 text-black font-bold rounded">Play</button>
              </div>
            ))}
          </div>
        </div>
      );
    }

    function Beyonders({ beyonders, getAvatar }) {
      return (
        <div className="space-y-6">
          <h2 className="text-3xl title-font text-center" style={{color: '#d4af37'}}>
            All Beyonders ({beyonders.length})
          </h2>

          {beyonders.length === 0 ? (
            <div className="text-center py-20">
              <div className="text-6xl mb-4">üë•</div>
              <p className="text-xl mb-2">No beyonders yet!</p>
              <p className="text-sm text-gray-400">
                Be the first to select a pathway and become a beyonder
              </p>
            </div>
          ) : (
            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
              {beyonders.map(b => (
                <div key={b.user_id} className="glass rounded-xl p-4">
                  <div className="flex items-center gap-3 mb-3">
                    <img src={getAvatar(b.user_id, b.avatar)} className="profile-img" alt={b.username} />
                    <div>
                      <h3 className="font-bold">{b.username}</h3>
                      {b.sequence === 0 && <span className="text-xs bg-red-500 px-2 py-0.5 rounded">‚öúÔ∏è GOD</span>}
                      {b.sequence <= 3 && b.sequence > 0 && <span className="text-xs bg-yellow-500 text-black px-2 py-0.5 rounded">üëº ANGEL</span>}
                    </div>
                  </div>
                  <div className="space-y-1 text-xs">
                    <div className="flex justify-between">
                      <span>Pathway:</span>
                      <span className="capitalize font-bold" style={{color: '#d4af37'}}>{b.pathway}</span>
                    </div>
                    <div className="flex justify-between">
                      <span>Sequence:</span>
                      <span style={{color: '#d4af37'}}>{b.sequence}</span>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      );
    }

    function StatCard({ icon, title, value }) {
      return (
        <div className="glass rounded-xl p-4 text-center">
          <div className="text-4xl mb-2">{icon}</div>
          <div className="text-gray-400 text-xs">{title}</div>
          <div className="text-2xl font-bold" style={{color: '#d4af37'}}>{value}</div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>

</body>
</html>
