<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0a0a0a">
  <title>Aroodes Dashboard - Complete Stats</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=IM+Fell+English&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'IM Fell English', serif;
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
      color: #e9e9e9;
      min-height: 100vh;
    }

    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .title-font {
      font-family: 'Cinzel Decorative', serif;
    }

    .glass {
      background: rgba(30, 30, 50, 0.85);
      backdrop-filter: blur(10px);
      border: 2px solid #d4af37;
    }

    .glow {
      box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
    }

    .glow-hover:hover {
      box-shadow: 0 0 30px rgba(212, 175, 55, 0.5);
      transform: translateY(-5px);
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    .pulse {
      animation: pulse 2s ease-in-out infinite;
    }

    .float {
      animation: float 3s ease-in-out infinite;
    }

    .pathway-image {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      filter: drop-shadow(0 0 10px rgba(212, 175, 55, 0.3));
    }

    ::-webkit-scrollbar { width: 10px; }
    ::-webkit-scrollbar-track { background: #1a1a2e; }
    ::-webkit-scrollbar-thumb { 
      background: linear-gradient(180deg, #d4af37 0%, #8b4513 100%);
      border-radius: 5px;
    }

    .skeleton {
      background: linear-gradient(90deg, #1a1410 25%, #2a1810 50%, #1a1410 75%);
      background-size: 200% 100%;
      animation: skeleton-loading 1.5s ease-in-out infinite;
    }

    @keyframes skeleton-loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .card-flip {
      perspective: 1000px;
    }

    .card-inner {
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }

    .card-flip.flipped .card-inner {
      transform: rotateY(180deg);
    }

    .card-front, .card-back {
      backface-visibility: hidden;
    }

    .card-back {
      transform: rotateY(180deg);
    }
  </style>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#d4af37',
            dark: '#1a1a2e',
            darker: '#16213e'
          }
        }
      }
    }
  </script>
</head>
<body class="min-h-screen">
  
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const API_BASE = window.location.origin + '/api';

    // All 22 Pathways
    const PATHWAYS = [
      { id: 'fool', name: 'The Fool', image: '/pathways/fool.png', color: 'from-yellow-600 to-yellow-800' },
      { id: 'error', name: 'Error', image: '/pathways/error.png', color: 'from-purple-600 to-purple-900' },
      { id: 'door', name: 'Door', image: '/pathways/door.png.webp', color: 'from-cyan-600 to-indigo-800' },
      { id: 'visionary', name: 'Visionary', image: '/pathways/visionary.png.webp', color: 'from-purple-500 to-purple-800' },
      { id: 'sun', name: 'The Sun', image: '/pathways/sun.png.webp', color: 'from-yellow-400 to-red-600' },
      { id: 'tyrant', name: 'Tyrant', image: '/pathways/tyrant.png.webp', color: 'from-blue-600 to-blue-900' },
      { id: 'white_tower', name: 'White Tower', image: '/pathways/white_tower.png.webp', color: 'from-gray-300 to-gray-600' },
      { id: 'hanged_man', name: 'Hanged Man', image: '/pathways/hanged_man.png', color: 'from-teal-500 to-blue-700' },
      { id: 'darkness', name: 'Darkness', image: '/pathways/darkness.png.webp', color: 'from-gray-700 to-black' },
      { id: 'death', name: 'Death', image: '/pathways/death.png', color: 'from-gray-600 to-black' },
      { id: 'twilight', name: 'Twilight Giant', image: '/pathways/twilight_giant.png.webp', color: 'from-orange-600 to-red-900' },
      { id: 'demoness', name: 'Demoness', image: '/pathways/demoness.png.webp', color: 'from-pink-500 to-purple-900' },
      { id: 'red_priest', name: 'Red Priest', image: '/pathways/red_priest.png', color: 'from-red-500 to-red-900' },
      { id: 'moon', name: 'The Moon', image: '/pathways/moon.png', color: 'from-purple-400 to-purple-800' },
      { id: 'mother', name: 'Mother', image: '/pathways/mother.png.webp', color: 'from-green-500 to-green-900' },
      { id: 'abyss', name: 'Abyss', image: '/pathways/abyss.png.webp', color: 'from-gray-800 to-gray-900' },
      { id: 'chained', name: 'Chained', image: '/pathways/chained.png.webp', color: 'from-gray-600 to-black' },
      { id: 'justiciar', name: 'Justiciar', image: '/pathways/justiciar.png.webp', color: 'from-yellow-500 to-orange-700' },
      { id: 'paragon', name: 'Paragon', image: '/pathways/paragon.png.webp', color: 'from-slate-400 to-slate-800' },
      { id: 'black_emperor', name: 'Black Emperor', image: '/pathways/black_emperor.png.webp', color: 'from-purple-800 to-black' },
      { id: 'hermit', name: 'The Hermit', image: '/pathways/hermit.png.webp', color: 'from-amber-600 to-brown-900' },
      { id: 'wheel', name: 'Wheel of Fortune', image: '/pathways/wheel_of_fortune.png.webp', color: 'from-emerald-500 to-cyan-900' }
    ];

    function App() {
      const [activeTab, setActiveTab] = useState('dashboard');
      const [stats, setStats] = useState(null);
      const [beyonders, setBeyonders] = useState([]);
      const [leaderboard, setLeaderboard] = useState([]);
      const [loading, setLoading] = useState(true);
      const [selectedUser, setSelectedUser] = useState(null);
      const [searchTerm, setSearchTerm] = useState('');
      const [activityFeed, setActivityFeed] = useState([]);

      useEffect(() => {
        fetchAllData();
        // Auto-refresh every 30 seconds
        const interval = setInterval(fetchAllData, 30000);
        return () => clearInterval(interval);
      }, []);

      const fetchAllData = async () => {
        try {
          const [statsRes, beyondersRes, leaderboardRes] = await Promise.all([
            fetch(`${API_BASE}/stats`),
            fetch(`${API_BASE}/beyonders`),
            fetch(`${API_BASE}/leaderboard/sequence`)
          ]);

          const statsData = await statsRes.json();
          const beyondersData = await beyondersRes.json();
          const leaderboardData = await leaderboardRes.json();

          setStats(statsData);
          setBeyonders(beyondersData);
          setLeaderboard(leaderboardData);
          generateActivityFeed(beyondersData);
          setLoading(false);
        } catch (error) {
          console.error('Error fetching data:', error);
          setLoading(false);
        }
      };

      const generateActivityFeed = (beyondersData) => {
        const feed = beyondersData
          .sort((a, b) => new Date(b.assigned_at) - new Date(a.assigned_at))
          .slice(0, 10)
          .map(b => ({
            user: b.username,
            pathway: b.pathway,
            sequence: b.sequence,
            time: b.assigned_at
          }));
        setActivityFeed(feed);
      };

      return (
        <div className="min-h-screen">
          <Navbar activeTab={activeTab} setActiveTab={setActiveTab} />

          <div className="max-w-7xl mx-auto px-4 py-8">
            {loading ? (
              <LoadingScreen />
            ) : (
              <>
                {activeTab === 'dashboard' && <Dashboard stats={stats} activityFeed={activityFeed} />}
                {activeTab === 'beyonders' && (
                  <Beyonders 
                    beyonders={beyonders} 
                    onSelectUser={setSelectedUser}
                    searchTerm={searchTerm}
                    setSearchTerm={setSearchTerm}
                  />
                )}
                {activeTab === 'leaderboard' && <Leaderboard leaderboard={leaderboard} />}
                {activeTab === 'pathways' && <PathwaysGallery />}
                {activeTab === 'analytics' && <Analytics stats={stats} beyonders={beyonders} />}
              </>
            )}
          </div>

          {selectedUser && (
            <UserProfileModal user={selectedUser} onClose={() => setSelectedUser(null)} />
          )}
        </div>
      );
    }

    function Navbar({ activeTab, setActiveTab }) {
      const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

      const tabs = [
        { id: 'dashboard', name: 'Dashboard', icon: 'üìä' },
        { id: 'pathways', name: 'Pathways', icon: 'üé≠' },
        { id: 'beyonders', name: 'Beyonders', icon: 'üë•' },
        { id: 'leaderboard', name: 'Leaderboard', icon: 'üèÜ' },
        { id: 'analytics', name: 'Analytics', icon: 'üìà' }
      ];

      return (
        <nav className="glass sticky top-0 z-50 glow">
          <div className="max-w-7xl mx-auto px-4 py-4">
            <div className="flex justify-between items-center">
              <h1 className="text-xl md:text-3xl title-font text-primary float">
                üåô Aroodes Dashboard
              </h1>

              {/* Desktop Menu */}
              <div className="hidden md:flex gap-2">
                {tabs.map(tab => (
                  <button
                    key={tab.id}
                    onClick={() => setActiveTab(tab.id)}
                    className={`px-4 py-2 rounded-lg transition ${
                      activeTab === tab.id ? 'bg-primary text-dark' : 'hover:bg-primary/20'
                    }`}
                  >
                    {tab.icon} {tab.name}
                  </button>
                ))}
                <a href="/" className="px-4 py-2 rounded-lg bg-primary/20 hover:bg-primary/30 transition">
                  ‚Üê Back
                </a>
              </div>

              {/* Mobile Menu Button */}
              <button
                onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
                className="md:hidden text-2xl text-primary"
              >
                {mobileMenuOpen ? '‚úï' : '‚ò∞'}
              </button>
            </div>

            {/* Mobile Menu */}
            {mobileMenuOpen && (
              <div className="md:hidden mt-4 space-y-2">
                {tabs.map(tab => (
                  <button
                    key={tab.id}
                    onClick={() => {
                      setActiveTab(tab.id);
                      setMobileMenuOpen(false);
                    }}
                    className={`w-full text-left px-4 py-2 rounded-lg transition ${
                      activeTab === tab.id ? 'bg-primary text-dark' : 'hover:bg-primary/20'
                    }`}
                  >
                    {tab.icon} {tab.name}
                  </button>
                ))}
                <a href="/" className="block w-full text-left px-4 py-2 rounded-lg bg-primary/20">
                  ‚Üê Back to Main
                </a>
              </div>
            )}
          </div>
        </nav>
      );
    }

    function LoadingScreen() {
      return (
        <div className="text-center py-20">
          <div className="text-6xl mb-6 pulse">üåô</div>
          <div className="text-3xl text-primary animate-pulse title-font mb-4">
            Loading Mystical Data...
          </div>
          <div className="flex justify-center gap-2">
            <div className="w-3 h-3 bg-primary rounded-full animate-bounce" style={{ animationDelay: '0s' }}></div>
            <div className="w-3 h-3 bg-primary rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div>
            <div className="w-3 h-3 bg-primary rounded-full animate-bounce" style={{ animationDelay: '0.4s' }}></div>
          </div>
        </div>
      );
    }

    function Dashboard({ stats, activityFeed }) {
      if (!stats) return null;

      return (
        <div className="space-y-8">
          <h2 className="text-3xl md:text-4xl title-font text-primary text-center mb-8">
            üìä Server Overview
          </h2>

          {/* Enhanced Stats Cards */}
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
            <EnhancedStatCard 
              icon="üîÆ" 
              title="Total Beyonders" 
              value={stats.totalBeyonders}
              subtitle="Active Users"
              color="primary"
            />
            <EnhancedStatCard 
              icon="üëº" 
              title="Angels" 
              value={stats.angels}
              subtitle="Seq 1-3"
              color="yellow-400"
            />
            <EnhancedStatCard 
              icon="‚öúÔ∏è" 
              title="True Gods" 
              value={stats.trueGods}
              subtitle="Sequence 0"
              color="red-500"
            />
            <EnhancedStatCard 
              icon="üìà" 
              title="Avg Sequence" 
              value={stats.averageSequence.toFixed(1)}
              subtitle="Server Average"
              color="blue-400"
            />
          </div>

          {/* Activity Feed + Charts */}
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            {/* Activity Timeline */}
            <div className="lg:col-span-1">
              <ActivityTimeline feed={activityFeed} />
            </div>

            {/* Distribution Charts */}
            <div className="lg:col-span-2 space-y-6">
              <PathwayDistribution stats={stats} />
              <SequenceDistribution stats={stats} />
            </div>
          </div>
        </div>
      );
    }

    function EnhancedStatCard({ icon, title, value, subtitle, color }) {
      return (
        <div className="glass rounded-xl p-6 glow-hover transition cursor-pointer">
          <div className="flex items-start justify-between">
            <div>
              <div className="text-gray-400 text-sm mb-1">{title}</div>
              <div className={`text-4xl font-bold text-${color} mb-2`}>{value}</div>
              <div className="text-xs text-gray-500">{subtitle}</div>
            </div>
            <div className="text-5xl float">{icon}</div>
          </div>
        </div>
      );
    }

    function ActivityTimeline({ feed }) {
      return (
        <div className="glass rounded-xl p-6 h-full">
          <h3 className="text-xl title-font text-primary mb-4 flex items-center gap-2">
            üìú Recent Activity
          </h3>
          <div className="space-y-3 max-h-96 overflow-y-auto">
            {feed.map((activity, i) => (
              <div key={i} className="border-l-2 border-primary pl-4 py-2 hover:bg-primary/5 transition rounded">
                <div className="text-sm font-semibold">{activity.user}</div>
                <div className="text-xs text-gray-400 capitalize">
                  Joined {activity.pathway} pathway at Seq {activity.sequence}
                </div>
                <div className="text-xs text-gray-500">
                  {new Date(activity.time).toLocaleString()}
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    }

    function PathwayDistribution({ stats }) {
      return (
        <div className="glass rounded-xl p-6">
          <h3 className="text-xl title-font text-primary mb-4">üé≠ Pathway Distribution</h3>
          <div className="space-y-3">
            {stats.pathwayDistribution.slice(0, 8).map((pathway, i) => (
              <div key={i} className="flex items-center gap-4">
                <div className="w-32 text-sm capitalize truncate">{pathway.pathway}</div>
                <div className="flex-1 bg-gray-700 rounded-full h-8 overflow-hidden relative">
                  <div 
                    className="bg-gradient-to-r from-primary to-yellow-500 h-full flex items-center justify-end px-3 text-sm font-bold transition-all duration-1000"
                    style={{ width: `${(pathway.count / stats.totalBeyonders * 100)}%` }}
                  >
                    {pathway.count}
                  </div>
                </div>
                <div className="text-sm text-gray-400 w-16 text-right">
                  {((pathway.count / stats.totalBeyonders * 100)).toFixed(1)}%
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    }

    function SequenceDistribution({ stats }) {
      return (
        <div className="glass rounded-xl p-6">
          <h3 className="text-xl title-font text-primary mb-4">üìä Sequence Distribution</h3>
          <div className="space-y-3">
            {stats.sequenceDistribution.sort((a, b) => a.sequence - b.sequence).map((seq, i) => (
              <div key={i} className="flex items-center gap-4">
                <div className="w-24 text-sm">
                  {seq.sequence === 0 ? '‚öúÔ∏è Seq 0' : seq.sequence <= 3 ? 'üëº Seq ' + seq.sequence : 'üîÆ Seq ' + seq.sequence}
                </div>
                <div className="flex-1 bg-gray-700 rounded-full h-8 overflow-hidden">
                  <div 
                    className={`h-full flex items-center justify-end px-3 text-sm font-bold transition-all duration-1000 ${
                      seq.sequence === 0 ? 'bg-gradient-to-r from-red-600 to-red-800' : 
                      seq.sequence <= 3 ? 'bg-gradient-to-r from-yellow-500 to-orange-500' : 
                      'bg-gradient-to-r from-blue-500 to-cyan-500'
                    }`}
                    style={{ width: `${(seq.count / stats.totalBeyonders * 100)}%` }}
                  >
                    {seq.count}
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    }

    function PathwaysGallery() {
      const [selectedPathway, setSelectedPathway] = useState(null);

      return (
        <div className="space-y-8">
          <h2 className="text-3xl md:text-4xl title-font text-primary text-center mb-8">
            üé≠ All 22 Pathways
          </h2>

          <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
            {PATHWAYS.map(pathway => (
              <PathwayCard 
                key={pathway.id} 
                pathway={pathway}
                onClick={() => setSelectedPathway(pathway)}
              />
            ))}
          </div>

          {selectedPathway && (
            <PathwayModal pathway={selectedPathway} onClose={() => setSelectedPathway(null)} />
          )}
        </div>
      );
    }

    function PathwayCard({ pathway, onClick }) {
      const [imageLoaded, setImageLoaded] = useState(false);

      return (
        <div 
          onClick={onClick}
          className="glass rounded-xl p-4 cursor-pointer glow-hover transition group"
        >
          <div className="h-32 flex items-center justify-center mb-3 bg-black/30 rounded-lg overflow-hidden">
            {!imageLoaded && <div className="skeleton w-full h-full"></div>}
            <img 
              src={pathway.image}
              alt={pathway.name}
              className={`pathway-image group-hover:scale-110 transition-transform duration-500 ${imageLoaded ? 'opacity-100' : 'opacity-0'}`}
         
